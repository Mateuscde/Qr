<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparar Imagem com Câmera</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        video, canvas {
            margin: 10px;
            border: 2px solid black;
        }
    </style>
</head>
<body>

    <input type="file" id="fileInput">
    <video id="video" width="320" height="240" autoplay></video>
    <button id="captureBtn">Capturar com Câmera</button>
    <canvas id="canvas1" width="320" height="240" style="display:none;"></canvas>
    <canvas id="canvas2" width="320" height="240"></canvas>

    <script>
        const video = document.getElementById('video');
        const canvas1 = document.getElementById('canvas1');
        const canvas2 = document.getElementById('canvas2');
        const captureBtn = document.getElementById('captureBtn');
        const context1 = canvas1.getContext('2d');
        const context2 = canvas2.getContext('2d');
        const fileInput = document.getElementById('fileInput');
        let imageLoaded = false;

        // Acessar a câmera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                video.srcObject = stream;
            })
            .catch(function(err) {
                console.log("Erro ao acessar a câmera: " + err);
            });

        // Carregar imagem do arquivo
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    context1.clearRect(0, 0, canvas1.width, canvas1.height);
                    context1.drawImage(img, 0, 0, canvas1.width, canvas1.height);
                    imageLoaded = true;
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        });

        // Capturar imagem da câmera e comparar
        captureBtn.addEventListener('click', function() {
            if (imageLoaded) {
                context2.drawImage(video, 0, 0, 320, 240);
                compareImages();
            } else {
                alert("Selecione uma imagem primeiro!");
            }
        });

        // Função para comparar as duas imagens pixel a pixel
        function compareImages() {
            const imgData1 = context1.getImageData(0, 0, canvas1.width, canvas1.height);
            const imgData2 = context2.getImageData(0, 0, canvas2.width, canvas2.height);
            let diffPixels = 0;

            for (let i = 0; i < imgData1.data.length; i += 4) {
                const r1 = imgData1.data[i];
                const g1 = imgData1.data[i + 1];
                const b1 = imgData1.data[i + 2];

                const r2 = imgData2.data[i];
                const g2 = imgData2.data[i + 1];
                const b2 = imgData2.data[i + 2];

                // Comparando valores RGB com uma margem de diferença
                const threshold = 50; // margem de diferença permitida
                if (Math.abs(r1 - r2) > threshold || Math.abs(g1 - g2) > threshold || Math.abs(b1 - b2) > threshold) {
                    diffPixels++;
                }
            }

            const totalPixels = canvas1.width * canvas1.height;
            const similarity = ((totalPixels - diffPixels) / totalPixels) * 100;

            if (similarity > 80) { // se as imagens forem 80% semelhantes ou mais
                alert(`As imagens são semelhantes! Similaridade: ${similarity.toFixed(2)}%`);
            } else {
                alert(`As imagens são diferentes. Similaridade: ${similarity.toFixed(2)}%`);
            }
        }
    </script>

</body>
</html>
